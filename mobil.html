<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hra s letadly</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        #map {
            width: 100%;
            height: 60vh;
            max-height: 60vh;
        }

        #menu {
            width: 100%;
            max-width: 500px;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }

        #menu h2 {
            margin-top: 0;
        }

        #menu .section {
            margin-bottom: 15px;
        }

        #menu .section button,
        #menu .section select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }

        #menu .section button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #menu .section button:hover {
            background-color: #0056b3;
        }

        #menu .section select {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Responzivní design */
        @media (max-width: 768px) {
            #map {
                height: 50vh;
            }
            #menu {
                padding: 5px;
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="map"></div>
        <div id="menu">
            <h2>Hra s letadly</h2>
            <div class="section">
                <div id="money">Peněženka: 100 Kč</div>
            </div>
            <div class="section">
                <h3>Koupit letadlo</h3>
                <select id="plane-select">
                    <option value="mini">Mini Letadlo - 1000 Kč</option>
                    <option value="small">Malé Letadlo - 10000 Kč</option>
                    <option value="medium">Střední Letadlo - 50000 Kč</option>
                    <option value="large">Velké Letadlo - 150000 Kč</option>
                    <option value="jumbo">Velkokapacitní Letadlo - 500000 Kč</option>
                </select>
                <button onclick="buyPlane()">Koupit</button>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialize the map and set its view to Prague
        var map = L.map('map').setView([50.0755, 14.4378], 5);

        // Add the OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Initial money
        var money = 100;

        // Update money display
        function updateMoneyDisplay() {
            document.getElementById('money').textContent = "Peněženka: " + Math.round(money) + " Kč";
        }

        // Custom icon for airports
        var airportIcon = L.icon({
            iconUrl: 'https://i.imgur.com/dU2KpHP.png',
            iconSize: [32, 32], // size of the icon
            iconAnchor: [16, 16], // point of the icon which will correspond to marker's location
            popupAnchor: [0, -16] // point from which the popup should open relative to the iconAnchor
        });

        // Custom icons for planes
        var planeIcons = {
            mini: L.icon({ iconUrl: 'https://i.imgur.com/dU2KpHP.png', iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -16] }),
            small: L.icon({ iconUrl: 'https://i.imgur.com/small-icon.png', iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -16] }),
            medium: L.icon({ iconUrl: 'https://i.imgur.com/medium-icon.png', iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -16] }),
            large: L.icon({ iconUrl: 'https://i.imgur.com/large-icon.png', iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -16] }),
            jumbo: L.icon({ iconUrl: 'https://i.imgur.com/jumbo-icon.png', iconSize: [32, 32], iconAnchor: [16, 16], popupAnchor: [0, -16] })
        };

        // List of airports
        var airports = [
             { name: "Letiště Praha Letňany (LKLT)", coords: [50.1313861, 14.5255528], unlocked: false, cost: 2300, passengers: {} },
            { name: "Letiště Praha Točná (LKTC)", coords: [49.9854383, 14.4264211], unlocked: false, cost: 600, passengers: {} },
            { name: "Letiště Hosín (LKHS)", coords: [49.0399972, 14.4949972], unlocked: false, cost: 6500, passengers: {} },
            { name: "Letiště Strakonice (LKST)", coords: [49.2516639, 13.8927750], unlocked: false, cost: 4500, passengers: {} },
             { name: "Letiště Strunkovice (LKSR)", coords: [49.0824972, 14.0758306], unlocked: false, cost: 7000, passengers: {} },
            { name: "Letiště Blatná (LKBL)", coords: [49.4312472, 13.7996083], unlocked: false, cost: 3000, passengers: {} },
            { name: "Letiště Plzeň Líně (LKLN)", coords: [49.6752750, 13.2744417], unlocked: false, cost: 500, passengers: {} },
             { name: "Letiště Příbram (LKPM)", coords: [49.7199972, 14.1002750], unlocked: false, cost: 4000, passengers: {} },
            { name: "Letiště Praha Vodochody (LKVO)", coords: [50.2166639, 14.3955528], unlocked: false, cost: 1200, passengers: {} },
            { name: "Letiště Roudnice (LKRO)", coords: [50.4105528, 14.2261083], unlocked: false, cost: 5000, passengers: {} },
             { name: "Letiště Most (LKMO)", coords: [50.5249972, 13.6830528], unlocked: false, cost: 1300, passengers: {} },
            { name: "Letiště Panenský Týnec (LKPC)", coords: [50.3063861, 13.9341639], unlocked: false, cost: 2800, passengers: {} },
        { name: "Letiště Velké Poříčí (LKVP)", coords: [50.4677778, 16.2055556], unlocked: false, cost: 3000, passengers: {} },
            { name: "Letiště Vrchlabí (LKVR)", coords: [50.6242864, 15.6465147], unlocked: false, cost: 500, passengers: {} },
             { name: "Letiště Broumov (LKBR)", coords: [50.5616239, 16.3422106], unlocked: false, cost: 4000, passengers: {} },
            { name: "Letiště Liberec (LKLB)", coords: [50.7671272, 15.0230761], unlocked: false, cost: 3500, passengers: {} },
            { name: "Letiště Hradčany (LKHRAD)", coords: [50.6194417, 14.7327750], unlocked: false, cost: 5000, passengers: {} },
             { name: "Letiště Česká Lípa (LKCE)", coords: [50.7095317, 14.5668706], unlocked: false, cost: 13000, passengers: {} },
            { name: "Letiště Hodkovice (LKHD)", coords: [50.6572194, 15.0777750], unlocked: false, cost: 8000, passengers: {} },
            { name: "Letiště Mnichovo Hradiště (LKMH)", coords: [50.5399972, 15.0066639], unlocked: false, cost: 8500, passengers: {} },
         { name: "Letiště Podhořany (LKPN)", coords: [49.9391639, 15.5497194], unlocked: false, cost: 13000, passengers: {} },
            { name: "Letiště Chrudim (LKCR)", coords: [49.9354142, 15.7811158], unlocked: false, cost: 8000, passengers: {} },
            { name: "Letiště Hradec Králové (LKHK)", coords: [50.2443344, 15.8461386], unlocked: false, cost: 8500, passengers: {} },
            { name: "Letiště Jaroměř (LKJA)", coords: [50.3313861, 15.9538861], unlocked: false, cost: 11000, passengers: {} },
            { name: "Letiště Dvůr Králové (LKDK)", coords: [50.4143281, 15.8373064], unlocked: false, cost: 9000, passengers: {} },
             { name: "Letiště Nové Město (LKNM)", coords: [50.3641639, 16.1136083], unlocked: false, cost: 9500, passengers: {} },
            { name: "Letiště Náchod (LKNACH)", coords: [50.4129672, 16.1218878], unlocked: false, cost: 10000, passengers: {} },
        { name: "Letiště Kolín (LKKO)", coords: [50.0019417, 15.1733306], unlocked: false, cost: 1300, passengers: {} },
            { name: "Letiště Milovice (LKMILO)", coords: [50.2379322, 14.9097447], unlocked: false, cost: 1500, passengers: {} },
            { name: "Letiště Mladá Boleslav (LKMB)", coords: [50.3983333, 14.8983333], unlocked: false, cost: 2000, passengers: {} },
            { name: "Letiště Sazená (LKSZ)", coords: [50.3230992, 14.2607631], unlocked: false, cost: 350, passengers: {} },
            { name: "Letiště Kladno (LKKL)", coords: [50.1127750, 14.0897194], unlocked: false, cost: 350, passengers: {} },
            { name: "Letiště Benešov (LKBE)", coords: [49.7408333, 14.6447222], unlocked: false, cost: 350, passengers: {} },
        { name: "Letiště Zbraslavice (LKZB)", coords: [49.8141639, 15.2016639], unlocked: false, cost: 1300, passengers: {} },
            { name: "Letiště Čáslav (LKCV)", coords: [49.9418489, 15.3812369], unlocked: false, cost: 1500, passengers: {} },
         { name: "Letiště Václava Havla Praha (PRG)", coords: [50.1008, 14.2632], unlocked: true, passengers: {} },
            { name: "Letiště Berlín-Braniborsko(BER)", coords: [52.3667, 13.5033], unlocked: false, cost: 13000, passengers: {} },
            { name: "Letiště Charlese de Gaulla Paříž(CDG)", coords: [49.0097, 2.5479], unlocked: false, cost: 15000, passengers: {} },
            { name: "Letiště Schiphol Amsterdam(AMS)", coords: [52.3105, 4.7683], unlocked: false, cost: 14000, passengers: {} },
            { name: "Letiště Heathrow Londýn(LHR)", coords: [51.4700, -0.4543], unlocked: false, cost: 100, passengers: {} },
            { name: "Letiště Brno Tuřany(BRQ)", coords: [49.1535236, 16.6920311], unlocked: false, cost: 50, passengers: {} },
            { name: "Letiště Ostrava(OSR)", coords: [49.6961489, 18.1110528], unlocked: false, cost: 100, passengers: {} },
            { name: "Letiště Karlovy Vary (KLV)", coords: [50.2033656, 12.9139397], unlocked: false, cost: 200, passengers: {} },
            { name: "Letiště Drážďany (DRS)", coords: [51.1342992, 13.7694808], unlocked: false, cost: 2500, passengers: {} },
            { name: "Letiště Mnichov (MUC)", coords: [48.3539625, 11.7785925], unlocked: false, cost: 12000, passengers: {} },
             { name: "Letiště Linec (LNZ)", coords: [48.2363750, 14.1877133], unlocked: false, cost: 1000, passengers: {} },
            { name: "Letiště Vídeň (VIE)", coords: [48.1049967, 16.5848986], unlocked: false, cost: 2000, passengers: {} },
            { name: "Letiště Graz (GRZ)", coords: [46.9887481, 15.4400233], unlocked: false, cost: 6000, passengers: {} },
            { name: "Letiště Klagenfurt (KLU)", coords: [46.6434817, 14.3285997], unlocked: false, cost: 6500, passengers: {} },
            { name: "Letiště Innsbruck (INN)", coords: [47.2597258, 11.3418706], unlocked: false, cost: 4500, passengers: {} },
             { name: "Letiště Salzburk (SZG)", coords: [47.7934550, 13.0018306], unlocked: false, cost: 7000, passengers: {} },
            { name: "Letiště Bratislava (BTS)", coords: [48.1722903, 17.2134972], unlocked: false, cost: 3000, passengers: {} },
            { name: "Letiště České Budějovice (JCL)", coords: [48.9463861, 14.4274972], unlocked: false, cost: 500, passengers: {} },
             { name: "Letiště Košice (KSC)", coords: [48.6614342, 21.2391397], unlocked: false, cost: 4000, passengers: {} },
            { name: "Letiště Poprad (TAT)", coords: [49.0712142, 20.2472575], unlocked: false, cost: 3500, passengers: {} },
            { name: "Letiště Kraków-Balice (KRK)", coords: [50.0782553, 19.7862536], unlocked: false, cost: 5000, passengers: {} },
             { name: "Letiště Varšava (WAW)", coords: [52.1630650, 20.9708150], unlocked: false, cost: 13000, passengers: {} },
            { name: "Poznań-Ławica Airport (POZ)", coords: [52.4205639, 16.8317917], unlocked: false, cost: 8000, passengers: {} },
            { name: "Letiště Gdaňsk (GDN)", coords: [54.3762064, 18.4744550], unlocked: false, cost: 8500, passengers: {} },
            { name: "Letiště Hamburk (HAM)", coords: [53.6363622, 9.9945500], unlocked: false, cost: 11000, passengers: {} },
            { name: "Letiště Stuttgart (STR)", coords: [48.6884219, 9.2053925], unlocked: false, cost: 9000, passengers: {} },
             { name: "Letiště Basel-Mulhouse-Freiburg (BSL)", coords: [47.6032369, 7.5243481], unlocked: false, cost: 9500, passengers: {} },
            { name: "Letiště Frankfurt nad Mohanem (FRA)", coords: [50.0229503, 8.5249514], unlocked: false, cost: 10000, passengers: {} },
        ];

        // List of planes
        var planes = [];

        // Function to add airport markers to the map
        function addAirportMarkers() {
            airports.forEach(function (airport) {
                var marker = L.marker(airport.coords, { icon: airportIcon }).addTo(map)
                    .bindPopup(generateAirportPopupContent(airport));
                airport.marker = marker;
            });
        }

        // Function to generate passengers every minute
        function generatePassengers() {
            airports.forEach(function (airport) {
                if (airport.unlocked) {
                    var destinations = airports.filter(a => a.unlocked && a.name !== airport.name);
                    destinations.forEach(function (destination) {
                        if (!airport.passengers[destination.name]) {
                            airport.passengers[destination.name] = 0;
                        }
                        airport.passengers[destination.name] += Math.floor(Math.random() * 10); // Random number of passengers
                    });
                    updatePopupContent(airport);
                }
            });
        }

        // Function to update the popup content of an airport
        function updatePopupContent(airport) {
            var content = generateAirportPopupContent(airport);
            airport.marker.getPopup().setContent(content);
        }

        // Function to generate the popup content of an airport
        function generateAirportPopupContent(airport) {
            var content = "<strong>" + airport.name + "</strong><br>";
            if (!airport.unlocked) {
                content += "<button onclick='unlockAirport(\"" + airport.name + "\")'>Odemknout za " + airport.cost + " Kč</button>";
            } else {
                content += "<strong>Čekající pasažéři:</strong><br>";
                for (var destination in airport.passengers) {
                    content += destination + ": " + airport.passengers[destination] + "<br>";
                }
            }
            return content;
        }

        // Function to unlock an airport
        function unlockAirport(name) {
            var airport = airports.find(a => a.name === name);
            if (money >= airport.cost) {
                money -= airport.cost;
                airport.unlocked = true;
                updateMoneyDisplay();
                updatePopupContent(airport);
            } else {
                alert("Nemáte dostatek peněz!");
            }
        }

        // Function to buy a plane
        function buyPlane() {
            var planeType = document.getElementById('plane-select').value;
            var planeDetails;
            switch (planeType) {
                case 'mini':
                    planeDetails = { type: 'mini', capacity: 4, range: 500, speed: 2500, cost: 1000 };
                    break;
                case 'small':
                    planeDetails = { type: 'small', capacity: 30, range: 1200, speed: 2500, cost: 10000 };
                    break;
                case 'medium':
                    planeDetails = { type: 'medium', capacity: 70, range: 2000, speed: 3500, cost: 50000 };
                    break;
                case 'large':
                    planeDetails = { type: 'large', capacity: 150, range: 5000, speed: 5000, cost: 150000 };
                    break;
                case 'jumbo':
                    planeDetails = { type: 'jumbo', capacity: 300, range: 15000, speed: 7500, cost: 500000 };
                    break;
            }

            if (money >= planeDetails.cost) {
                money -= planeDetails.cost;
                updateMoneyDisplay();

                var plane = {
                    type: planeDetails.type,
                    capacity: planeDetails.capacity,
                    range: planeDetails.range,
                    speed: planeDetails.speed,
                    cost: planeDetails.cost,
                    registration: 'OK-' + Math.random().toString(36).substr(2, 3).toUpperCase(),
                    marker: L.marker([50.1008, 14.2632], { icon: planeIcons[planeDetails.type] }).addTo(map)
                        .bindPopup(generatePlanePopupContent(plane)),
                    inFlight: false,
                    passengers: 0,
                    destination: null
                };

                planes.push(plane);
            } else {
                alert("Nemáte dostatek peněz!");
            }
        }

        // Function to generate the popup content of a plane
        function generatePlanePopupContent(plane) {
            var content = "<strong>Letadlo " + plane.registration + "</strong><br>";
            content += "Kapacita: " + plane.capacity + "<br>";
            content += "Dolet: " + plane.range + " km<br>";
            content += "Rychlost: " + plane.speed + " km/h<br>";
            if (!plane.inFlight) {
                content += "<select id='destination-select-" + plane.registration + "'>";
                var currentAirport = airports.find(a => a.coords[0] === plane.marker.getLatLng().lat && a.coords[1] === plane.marker.getLatLng().lng);
                for (var destination in currentAirport.passengers) {
                    if (currentAirport.passengers[destination] > 0) {
                        content += "<option value='" + destination + "'>" + destination + " (" + currentAirport.passengers[destination] + ")</option>";
                    }
                }
                content += "</select><br>";
                content += "<button onclick='sendPlane(\"" + plane.registration + "\")'>Odeslat</button>";
            }
            return content;
        }

        // Function to send a plane to a selected destination
        function sendPlane(registration) {
            var plane = planes.find(p => p.registration === registration);
            var select = document.getElementById('destination-select-' + registration);
            var destination = select.value;
            var fromAirport = airports.find(a => a.coords[0] === plane.marker.getLatLng().lat && a.coords[1] === plane.marker.getLatLng().lng);

            if (plane && fromAirport.passengers[destination] > 0) {
                var passengersToLoad = Math.min(plane.capacity, fromAirport.passengers[destination]);
                plane.passengers = passengersToLoad;
                fromAirport.passengers[destination] -= passengersToLoad;
                updatePopupContent(fromAirport);

                plane.destination = destination;
                plane.inFlight = true;

                var toAirport = airports.find(a => a.name === destination);
                flyPlane(plane, fromAirport, toAirport);

                plane.marker.bindPopup(generatePlanePopupContent(plane)).openPopup();
            } else {
                alert("Není dostatek pasažérů pro tuto destinaci!");
            }
        }

        // Function to animate a plane from one airport to another
        function flyPlane(plane, fromAirport, toAirport) {
            var planeMarker = plane.marker;
            var fromLatLng = L.latLng(fromAirport.coords);
            var toLatLng = L.latLng(toAirport.coords);

            var planePath = [fromLatLng, toLatLng];
            var polyline = L.polyline(planePath, { color: 'blue' }).addTo(map);

            var currentStep = 0;
            var totalSteps = 100;
            var distance = map.distance(fromLatLng, toLatLng) / 1000; // in kilometers
            var travelTime = (distance / plane.speed) * 3600 * 1000; // in milliseconds
            var stepInterval = travelTime / totalSteps;

            var flightInterval = setInterval(function() {
                if (currentStep >= totalSteps) {
                    clearInterval(flightInterval);
                    map.removeLayer(polyline);
                    plane.marker.setLatLng(toLatLng);
                    plane.inFlight = false;

                    // Calculate earnings
                    var earnings = distance * 3 * plane.passengers;
                    money += Math.round(earnings);
                    updateMoneyDisplay();
                    
                    plane.passengers = 0;
                    plane.marker.bindPopup(generatePlanePopupContent(plane)).openPopup();

                    // Update destination airport's popup content
                    updatePopupContent(toAirport);
                    
                    return;
                }
                var currentLatLng = L.latLng(
                    fromLatLng.lat + (toLatLng.lat - fromLatLng.lat) * (currentStep / totalSteps),
                    fromLatLng.lng + (toLatLng.lng - fromLatLng.lng) * (currentStep / totalSteps)
                );
                planeMarker.setLatLng(currentLatLng);
                currentStep++;
            }, stepInterval);
        }

        // Initial setup
        updateMoneyDisplay();
        addAirportMarkers();
        setInterval(generatePassengers, 60000); // Generate passengers every minute
    </script>
</body>
</html>
